CHROM=os.getenv('CHROM').split()
ANNOT_1COL_BED=os.getenv('ANNOT_1COL_BED')
ANNOT_LABEL=os.getenv('ANNOT_LABEL')

from os.path import dirname
ANNOT_1COL_DIR = dirname(ANNOT_1COL_BED)

rule all:
    input:
        variable_txt = os.path.join(ANNOT_1COL_DIR, "variable.txt"),
        annot_1col_chrom_bed = expand(os.path.join(ANNOT_1COL_DIR, "{chr}/%s_1col.bed"%ANNOT_LABEL), chr=CHROM),

rule variable_txt:
    input:
        annot_1col_bed = ANNOT_1COL_BED
    output:
        variable_txt = os.path.join(ANNOT_1COL_DIR, "variable.txt")
    threads: 8
    shell:
        """cut -f4,4 {input.annot_1col_bed} >{output.variable_txt}; LC_ALL=C sort --parallel {threads} -u {output.variable_txt} -o {output.variable_txt}"""

rule grep:
    input:
        annot_1col_bed = ANNOT_1COL_BED
    params:
        chr = "chr{chr}"
    output:
        annot_1col_chrom_bed = os.path.join(ANNOT_1COL_DIR, "{chr}/%s_1col.bed"%ANNOT_LABEL)
    shell:
        """LC_ALL=C grep -w {params.chr} {input.annot_1col_bed} >{output.annot_1col_chrom_bed}"""

