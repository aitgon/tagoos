ANNOT_LABEL = os.getenv('ANNOT_LABEL')
CHROM=os.getenv('CHROM').split()
DBSNP_DIR = os.getenv('DBSNP_DIR')
HOME = os.getenv('HOME')
MODEL_PKL = os.getenv('MODEL_PKL')
OUTDIR = os.getenv('OUTDIR')
SCRIPTDIR = os.getenv('SCRIPTDIR')

rule all:
    input:
        score_tsv = expand(os.path.join(OUTDIR, "chrom/{chr}/score.tsv"), chr=CHROM)
    output:
        score_tsv_merged = os.path.join(OUTDIR, "score.tsv")
    threads: 8
    shell:
        """LC_ALL=C sort -u --parallel {threads} {input.score_tsv} -o {output.score_tsv_merged}"""

rule chrom_score_tsv:
    input:
        libsvm = os.path.join(DBSNP_DIR, "chrom/{chr}", ANNOT_LABEL, "annotation.libsvm"),
        model_pkl = MODEL_PKL,
        script = os.path.join(SCRIPTDIR, "score.py"),
    output:
        score_tsv = os.path.join(OUTDIR, "chrom/{chr}/score.tsv"),
    shell:
        """{HOME}/Software/miniconda3/envs/tagoos/bin/python {input.script} {input.libsvm} {input.model_pkl} {output.score_tsv};"""


