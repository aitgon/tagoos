# Model learning and DBSNP variant prediction

## GRASP database

In this example we create a model for

- Associated GRASP variants (p-val <10⁸)
- 100000 random variants for the 1000 genome DB
- The __annotationcorr__ variants
- The __index__ variants

The important paramenters are set before the hash character

~~~
export TAG_RSID_POS=$HOME/data/2015_svmgwas/data/variant/GRASP/GRASP108.rsid
export POS_LABEL=GRASP108
export NEG_LABEL=1kg10000000
export ANNOT_LABEL=annotationcorr
export INDEX_LABEL=index3
export ANNOT_1COL_BED=$HOME/data/2015_svmgwas/data/annotation_ngs_based/${ANNOT_LABEL}/${ANNOT_LABEL}_1col.bed
export LD=0.8
~~~

~~~
export THREADS=8
#
export TAGDIR_POS=$PWD/out/${POS_LABEL}/pos/${ANNOT_LABEL}_${INDEX_LABEL}
export TAGDIR_NEG=$PWD/out/neg/${NEG_LABEL}_${ANNOT_LABEL}_${INDEX_LABEL}
export TAG_RSID_NEG=$HOME/data/2015_svmgwas/data/variant/1000genomes/${NEG_LABEL}.rsid
#
export ANNOTATION_BED=$HOME/data/2015_svmgwas/data/annotation_ngs_based/${ANNOT_LABEL}_1col.bed
export GENOME1K_DIR=$HOME/data/2015_svmgwas/data/variant/1000genomes
export GENOME1K_PEAKBED_DIR=$GENOME1K_DIR/intergenic_peak_bed
export INDEXDIR=$PWD/out/${INDEX_LABEL}
export PYTHONBIN=$(which python)
export SCRIPTDIR=${TAGOOS}/script
~~~

POSITIVE

~~~
export TAGDIR=$TAGDIR_POS
export LABEL=1
export TAG_RSID=$TAG_RSID_POS
#
time snakemake -s ${TAGOOS}/snakefile/rsid2chrom.yml -p -j 1 -c "qsub -X -V -d $TAGDIR -q tagc -l nodes=1:ppn={threads} -e $TAGDIR/stderr.log -o $TAGDIR/stdout.log" -d $TAGDIR -p
#
export CHROM=$(cat $TAGDIR/../chrom_list.txt)
#export CHROM=22
export NBCHROM=$(python -c "import os; print(2*len(os.getenv('CHROM').split()))")
time snakemake -s ${TAGOOS}/snakefile/tag.yml -p -j $NBCHROM -c "qsub -X -V -d $TAGDIR -q tagc -l nodes=1:ppn={threads} -e $TAGDIR/stderr.log -o $TAGDIR/stdout.log" -d $TAGDIR -pn
~~~

NEGATIVE

~~~
export TAGDIR=$TAGDIR_NEG
export LABEL=-1
export TAG_RSID=$TAG_RSID_NEG
#
time snakemake -s ${TAGOOS}/snakefile/tag.yml -p -j $NBCHROM -c "qsub -X -V -d $TAGDIR -q tagc -l nodes=1:ppn={threads} -e $TAGDIR/stderr.log -o $TAGDIR/stdout.log" -d $TAGDIR -pn
~~~

MODEL

~~~
export OUTDIR=$PWD/out/${POS_LABEL}/${NEG_LABEL}_${ANNOT_LABEL}_${INDEX_LABEL}
#
time snakemake -s ${TAGOOS}/snakefile/model.yml -p -j $NBCHROM -c "qsub -X -V -d $OUTDIR -q tagc -l nodes=1:ppn={threads} -e $OUTDIR/stderr.log -o $OUTDIR/stdout.log" -d $OUTDIR -pn
~~~

Score DBSNP

~~~
export DBSNP_DIR=$HOME/data/2015_svmgwas/data/variant/dbsnp
export MODEL_PKL=$PWD/out/${POS_LABEL}/${NEG_LABEL}_${ANNOT_LABEL}_${INDEX_LABEL}/model.pkl
export VARIABLE=$PWD/out/${POS_LABEL}/${NEG_LABEL}_${ANNOT_LABEL}_${INDEX_LABEL}/variable.txt
export SCRIPTDIR=${TAGOOS}/script
export OUTDIR=$PWD/out/${POS_LABEL}/${NEG_LABEL}_${ANNOT_LABEL}_${INDEX_LABEL}_dbsnp
#export CHROM=$($HOME/data/2015_svmgwas/data/hcomp/get_record  $HOME/data/2015_svmgwas/data/variant/1000genomes/eur/eur.peak.bed.idx $HOME/data/2015_svmgwas/data/variant/1000genomes/eur/eur.peak.bed -f $RSID_PATH |cut -f1 |tr -d "chr" |sort -u -k1n)
export CHROM=$(seq 1 22)
export NBCHROM=`python -c "import os; print(len(os.getenv('CHROM').split()))"`
time snakemake -s ${TAGOOS}/snakefile/score.yml -j ${NBCHROM} -c "qsub -X -V -d $OUTDIR -q tagc -l nodes=1:ppn={threads} -e $OUTDIR/stderr.log -o $OUTDIR/stdout.log" -d $OUTDIR -pn
~~~

